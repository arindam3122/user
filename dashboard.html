<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="linkup.png">
  <title>Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* Global Styles */
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f2f5;
      color: #333;
      display: flex; /* Make body a flex container */
      min-height: 100vh; /* Ensure body takes full viewport height */
    }

    /* Navigation Bar - Left Sidebar */
    nav {
      background-color: #46aa8c;
      color: white;
      padding: 25px 15px; /* Adjust padding for vertical layout */
      display: flex;
      flex-direction: column; /* Stack items vertically */
      justify-content: flex-start; /* Align items to the top */
      align-items: flex-start; /* Align items to the left */
      box-shadow: 2px 0 10px rgba(0,0,0,0.1); /* Shadow to the right */
      width: 220px; /* Fixed width for the sidebar */
      position: fixed; /* Keep it fixed on the left */
      top: 0;
      left: 0;
      bottom: 0; /* Make it span full height */
      z-index: 1000; /* Ensure it stays on top */
    }
    nav .brand {
      font-weight: bold;
      font-size: 32px; /* Slightly larger brand name */
      letter-spacing: 2px; /* Increased letter spacing */
      margin-bottom: 40px; /* Space below brand */
      align-self: center; /* Center the brand horizontally */
      background: linear-gradient(to right, #ffffff, #e6e6e6); /* Gradient for the text color */
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4); /* Deeper text shadow */
      display: flex; /* Enable flex for alignment of icon and text */
      align-items: center; /* Vertically align icon and text */
    }
    nav .brand img {
      height: 50px; /* Increased size of the icon */
      margin-right: 0; /* No space between icon and text, as text is removed */
    }
    nav .user-name {
      font-size: 1.2em;
      font-weight: bold;
      color: #e6e6e6;
      margin-bottom: 30px; /* Space below username */
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
      align-self: center; /* Center username */
    }
    nav .nav-links {
        display: flex;
        flex-direction: column; /* Stack links vertically */
        gap: 20px; /* Space between links */
        width: 100%; /* Take full width of nav */
        align-items: flex-start; /* Align links to the left */
        margin-bottom: auto; /* Push logout button to the bottom */
    }
    nav .nav-links a {
        color: white;
        text-decoration: none;
        font-size: 1.1em;
        font-weight: 500;
        padding: 10px 15px; /* Larger clickable area */
        border-radius: 5px;
        transition: background-color 0.2s ease, padding-left 0.2s ease;
        width: calc(100% - 30px); /* Adjust width for padding */
        display: flex; /* Enable flex for icon and text alignment */
        align-items: center; /* Vertically align icon and text */
    }
    nav .nav-links a i { /* Style for the icon */
        margin-right: 10px; /* Space between icon and text */
    }
    nav .nav-links a:hover {
        background-color: rgba(255, 255, 255, 0.2);
        padding-left: 20px; /* Slight indent on hover */
    }
    button.logout-btn {
      background: linear-gradient(45deg, #ff4c4c, #e04343);
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1em;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(255, 76, 76, 0.3);
      letter-spacing: 0.5px;
      text-transform: uppercase;
      font-weight: bold;
      align-self: center; /* Center the button */
      margin-top: 30px; /* Space above button */
      display: flex; /* Enable flex for icon and text alignment */
      align-items: center; /* Vertically align icon and text */
    }
    button.logout-btn i { /* Style for the icon */
        margin-right: 8px; /* Space between icon and text */
    }
    button.logout-btn:hover {
      background: linear-gradient(45deg, #e04343, #c9302c);
      box-shadow: 0 6px 12px rgba(255, 76, 76, 0.4);
      transform: translateY(-1px);
    }

    /* Main Content Area */
    .content {
      flex-grow: 1; /* Allow content to take remaining space */
      margin-left: 220px; /* Offset by the nav bar's width */
      max-width: calc(900px + 220px); /* Adjust max-width if needed to center */
      padding: 30px 40px; /* Adjust padding for the new layout */
      background: white;
      border-radius: 15px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
      margin-top: 30px; /* Keep top margin */
      margin-right: 30px; /* Add right margin for balance */
      margin-bottom: 30px; /* Add bottom margin */
      box-sizing: border-box; /* Include padding in element's total width and height */
    }
    /* Centering content within the main area */
    .content > div { /* Apply to direct children of .content like quiz-info-box etc. */
        max-width: 800px; /* Set a max-width for internal containers */
        margin-left: auto; /* Center them */
        margin-right: auto; /* Center them */
    }


    /* Existing Quiz Styles (no changes unless specified) */
    .login-success-message,
    .quiz-completed-message,
    .logout-success-message { /* Added logout-success-message here */
      position: fixed;
      top: 20px; /* Position at the top */
      right: 20px; /* Position at the right */
      left: auto; /* Ensure no conflict with left property */
      color: white;
      padding: 14px 25px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
      z-index: 1000;
      font-weight: bold;
      letter-spacing: 0.5px;
      font-size: 1.1em;
    }
    .login-success-message {
        background-color: #4CAF50;
    }
    .quiz-completed-message {
        background-color: #007bff;
    }
    .logout-success-message { /* Specific style for logout message */
        background-color: #f44336; /* A common color for "danger" or "logout" */
    }
    .login-success-message.show,
    .quiz-completed-message.show,
    .logout-success-message.show { /* Added logout-success-message here */
      opacity: 1;
      visibility: visible;
    }
    .quiz-container {
      margin-top: 30px;
      padding: 30px;
      border-radius: 12px;
      background-color: #ffffff;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      display: none;
      border: 1px solid #e0e0e0;
    }
    .quiz-question {
      font-size: 22px;
      margin-bottom: 25px;
      font-weight: bold;
      color: #0056b3;
      line-height: 1.4;
    }
    .quiz-options label {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      cursor: pointer;
      font-size: 18px;
      padding: 12px 15px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      transition: background-color 0.2s ease, border-color 0.2s ease;
    }
    .quiz-options label:hover {
      background-color: #f5f5f5;
      border-color: #007bff;
    }
    .quiz-options input[type="radio"] {
      margin-right: 15px;
      transform: scale(1.2);
    }
    .quiz-feedback {
      margin-top: 25px;
      padding: 15px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 1.1em;
      animation: fadeIn 0.5s ease-out;
    }
    .quiz-feedback.correct {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #28a745;
    }
    .quiz-feedback.incorrect {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #d9534f;
    }
    .quiz-navigation button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 25px;
      font-size: 18px;
      transition: background-color 0.2s ease, transform 0.2s ease;
      margin-right: 10px;
      display: inline-flex; /* Use flexbox for button content */
      align-items: center; /* Vertically align icon and text */
      justify-content: center; /* Center content horizontally */
    }
    .quiz-navigation button i { /* Style for icons within quiz navigation buttons */
        margin-right: 8px; /* Space between icon and text */
    }
    .quiz-navigation button#skipBtn {
        background-color: #ffc107;
        color: #333;
    }
    .quiz-navigation button#skipBtn:hover {
        background-color: #e0a800;
    }
    .quiz-navigation button:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
    }
    .quiz-navigation button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
      transform: none;
    }
    .timer {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 20px;
      color: #d9534f;
      text-align: right;
    }
    .final-score-container {
      text-align: center;
      margin-top: 40px;
      padding: 40px;
      border: 2px solid #007bff;
      border-radius: 15px;
      background-color: #eaf5ff;
      box-shadow: 0 6px 20px rgba(0, 123, 255, 0.15);
      display: none;
    }
    .final-score-container h2 {
      color: #007bff;
      margin-bottom: 25px;
      font-size: 2.2em;
    }
    .final-score-container p {
      font-size: 1.8em;
      font-weight: bold;
      color: #333;
      margin-bottom: 30px;
    }
    .final-score-summary {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #b3d7ff;
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
    }
    .final-score-summary div {
      font-size: 1.2em;
      font-weight: bold;
      color: #555;
      padding: 10px 15px;
      border-radius: 8px;
      background-color: #e0f0ff;
      box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);
    }
    .final-score-summary .correct-count {
      color: #28a745;
    }
    .final-score-summary .wrong-count {
      color: #d9534f;
    }
    .final-score-summary .skipped-count {
      color: #ffc107;
    }
    .quiz-navigation-button {
      background: linear-gradient(45deg, #28a745, #218838);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 1.3em;
      margin-top: 20px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
      letter-spacing: 0.8px;
      text-transform: uppercase;
      margin: 10px;
      display: inline-flex; /* Use flexbox for button content */
      align-items: center; /* Vertically align icon and text */
      justify-content: center; /* Center content horizontally */
    }
    .quiz-navigation-button i { /* Style for icons within final score buttons */
        margin-right: 8px; /* Space between icon and text */
    }
    .quiz-navigation-button:hover {
      background: linear-gradient(45deg, #218838, #1e7e34);
      box-shadow: 0 6px 18px rgba(40, 167, 69, 0.4);
      transform: translateY(-3px);
    }
    .quiz-navigation-button.view-answers {
        background: linear-gradient(45deg, #007bff, #0056b3);
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
    }
    .quiz-navigation-button.view-answers:hover {
        background: linear-gradient(45deg, #0056b3, #003f7f);
        box-shadow: 0 6px 18px rgba(0, 123, 255, 0.4);
    }
    .back-to-dashboard-btn,
    .previous-quizzes-btn {
        background: linear-gradient(45deg, #007bff, #0056b3);
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1em;
        transition: all 0.3s ease;
        box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        letter-spacing: 0.5px;
        text-transform: uppercase;
        font-weight: bold;
        text-decoration: none;
        display: inline-block;
        text-align: center;
    }
    .back-to-dashboard-btn:hover,
    .previous-quizzes-btn:hover {
        background: linear-gradient(45deg, #0056b3, #003f7f);
        box-shadow: 0 6px 12px rgba(0, 123, 255, 0.4);
        transform: translateY(-1px);
    }
    .quiz-info-box {
      margin-top: 30px;
      border: 1px solid #007bff;
      padding: 10px;
      border-radius: 12px;
      background-color: #eaf5ff;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 123, 255, 0.1);
    }
    .quiz-info-box h2 {
      color: #007bff;
      margin-bottom: 30px;
      font-size: 2.2em;
    }
    .quiz-info-box p {
      font-size: 1.3em;
      margin-bottom: 15px;
      line-height: 1.6;
    }
    .quiz-info-box button {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 18px 35px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.4em;
      margin-top: 30px;
      transition: background-color 0.2s ease, transform 0.2s ease;
      display: inline-flex; /* Use flexbox for button content */
      align-items: center; /* Vertically align icon and text */
      justify-content: center; /* Center content horizontally */
    }
    .quiz-info-box button i { /* Style for icons within quiz info box button */
        margin-right: 10px; /* Space between icon and text */
    }
    .quiz-info-box button:hover {
      background-color: #218838;
      transform: translateY(-2px);
    }
    .user-welcome-message {
      font-size: 2.5em;
      font-weight: bold;
      color: #28a745;
      margin-bottom: 30px;
      text-align: center;
      text-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    .quiz-results-details {
      margin-top: 30px;
      padding: 30px;
      border-radius: 12px;
      background-color: #ffffff;
      box-shadow: 0 4gpx 10px rgba(0,0,0,0.08);
      text-align: left;
      display: none;
      border: 1px solid #e0e0e0;
    }
    .quiz-results-details h3 {
      color: #007bff;
      margin-bottom: 20px;
      text-align: center;
      font-size: 1.8em;
      border-bottom: 2px solid #eaf5ff;
      padding-bottom: 10px;
    }
    .quiz-results-details .result-item {
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px dashed #ddd;
    }
    .quiz-results-details .result-item:last-child {
      border-bottom: none;
    }
    .quiz-results-details .question {
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 1.25em;
      color: #555;
    }
    .quiz-results-details .your-answer {
      color: #d9534f;
      font-style: italic;
      margin-left: 10px;
      font-size: 1.1em;
    }
    .quiz-results-details .correct-answer {
      color: #28a745;
      font-weight: bold;
      margin-left: 10px;
      font-size: 1.1em;
    }
    .quiz-results-details .your-answer.correct {
      color: #28a745;
    }
    .quiz-results-details .your-answer.skipped {
        color: #ffc107;
        font-weight: bold;
    }
    /* Progress Bar Styles */
    #progressBarContainer {
      width: 100%;
      height: 15px;
      background-color: #e0e0e0;
      border-radius: 8px;
      margin-bottom: 25px;
      overflow: hidden;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
    }
    #progressBarFill {
      height: 100%;
      width: 0%;
      background: linear-gradient(to right, #007bff, #00c6ff);
      border-radius: 8px;
      transition: width 0.5s ease-in-out;
      box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }
    /* Removed previous-quizzes-container styles as it's no longer needed */
    /* .previous-quizzes-container {
        display: none;
        margin-top: 30px;
        padding: 30px;
        border-radius: 12px;
        background-color: #ffffff;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        text-align: left;
        border: 1px solid #e0e0e0;
    }
    .previous-quizzes-container h3 {
        color: #007bff;
        margin-bottom: 20px;
        text-align: center;
        font-size: 1.8em;
        border-bottom: 2px solid #eaf5ff;
        padding-bottom: 10px;
    }
    .previous-quizzes-container .quiz-entry {
        margin-bottom: 15px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
    }
    .previous-quizzes-container .quiz-entry p {
        margin: 0;
        font-size: 1.1em;
        color: #555;
    }
    .previous-quizzes-container .quiz-entry .action-buttons {
        display: flex;
        gap: 10px;
    }
    .previous-quizzes-container .quiz-entry .view-details-btn,
    .previous-quizzes-container .quiz-entry .delete-details-btn {
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
        transition: background-color 0.2s ease;
    }
    .previous-quizzes-container .quiz-entry .view-details-btn {
        background-color: #007bff;
    }
    .previous-quizzes-container .quiz-entry .view-details-btn:hover {
        background-color: #0056b3;
    }
    .previous-quizzes-container .quiz-entry .delete-details-btn {
        background-color: #dc3545;
    }
    .previous-quizzes-container .quiz-entry .delete-details-btn:hover {
        background-color: #c82333;
    }
    .previous-quizzes-container .no-previous-quizzes {
        text-align: center;
        font-style: italic;
        color: #777;
        margin-top: 20px;
    } */
    /* Keyframe for fade-in effect */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Styles for image display in quiz */
    .question-image {
        max-width: 80%;
        height: auto;
        display: block;
        margin: 15px auto 25px auto; /* Center the image and add vertical spacing */
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <nav>
    <div class="brand">
      <img src="linkup.png" alt="LinkUP Icon">
    </div>
    <span class="user-name" id="userName"></span>
    <div class="nav-links">
      <a href="#" onclick="goToDashboard()"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      </div>
    <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </nav>

  <div class="content">
    <div id="loginSuccessMessage" class="login-success-message">Login Successful!</div>
    <div id="quizCompletedMessage" class="quiz-completed-message">Quiz Completed!</div>
    <div id="logoutSuccessMessage" class="logout-success-message">You have successfully been logged out!</div>

    <div class="user-welcome-message" id="welcomeMessage"></div>

    <div class="quiz-info-box" id="quizInfoBox">
      <h2 id="quizInfoHeading">Welcome to Quize</h2>
      <p>Total Questions: <span id="infoTotalQuestions"></span></p>
      <p>Time per question: <span id="infoTimePerQuestion"></span> seconds (varies per question)</p>
      <p id="lastQuizScoreDisplay" style="display: none;">Last Quiz Score: <span id="lastQuizScore">0</span> / <span id="lastQuizTotalQuestions">0</span></p>
      <p>Test your knowledge and see how well you score!</p>
      <button id="startQuizBtn"><i class="fas fa-play"></i> Start Quiz</button>
    </div>

    <div class="quiz-container" id="quizContainer">
      <h2>Questions on Biology</h2>
      <div class="timer" id="timer">Time left: 15s</div>
      <div id="progressBarContainer">
        <div id="progressBarFill"></div>
      </div>
      <div id="quiz"></div>
      <div class="quiz-feedback" id="feedback"></div>
      <div class="quiz-navigation">
        <button id="submitBtn" onclick="submitAnswer()"><i class="fas fa-check"></i> Submit Answer</button>
        <button id="skipBtn" onclick="skipQuestion()"><i class="fas fa-forward"></i> Skip Question</button> <button id="nextBtn" onclick="nextQuestion()" style="display: none;"><i class="fas fa-arrow-right"></i> Next Question</button>
      </div>
    </div>

    <div class="final-score-container" id="finalScoreContainer">
      <h2>Quiz Completed!</h2>
      <p>Your final score is: <span id="finalScore">0</span> / <span id="totalQuestions">0</span></p>
      <div class="final-score-summary">
        <div>Correct: <span id="finalCorrectAnswers" class="correct-count">0</span></div>
        <div>Wrong: <span id="finalWrongAnswers" class="wrong-count">0</span></div>
        <div>Skipped: <span id="finalSkippedQuestions" class="skipped-count">0</span></div>
      </div>
      <button class="quiz-navigation-button" onclick="retakeQuiz()"><i class="fas fa-redo"></i> Retake Quiz</button>
      <button class="quiz-navigation-button view-answers" onclick="showDetailedResults()"><i class="fas fa-file-alt"></i> View Detailed Answers</button>
    </div>

    <div class="quiz-results-details" id="quizResultsDetails">
      <h3>Detailed Results:</h3>
      </div>

    </div>

  <script>
    // Get username from localStorage
    const user = localStorage.getItem('loggedInUser');
    const welcomeMessageDiv = document.getElementById('welcomeMessage');
    const loginSuccessMessage = document.getElementById('loginSuccessMessage');
    const quizCompletedMessage = document.getElementById('quizCompletedMessage');
    const logoutSuccessMessage = document.getElementById('logoutSuccessMessage');

    // Quiz Info Box elements
    const quizInfoHeading = document.getElementById('quizInfoHeading');
    const lastQuizScoreDisplay = document.getElementById('lastQuizScoreDisplay');
    const lastQuizScoreSpan = document.getElementById('lastQuizScore');
    const lastQuizTotalQuestionsSpan = document.getElementById('lastQuizTotalQuestions');


    if (!user) {
      window.location.href = "index.html";
    } else {
      document.getElementById('userName').textContent = `Hello, ${user}`;
      welcomeMessageDiv.textContent = `${user}'s Dashboard`;

      const hasShownLoginMessage = localStorage.getItem('hasShownLoginMessage');
      if (hasShownLoginMessage === 'false' || hasShownLoginMessage === null) {
        loginSuccessMessage.classList.add('show');
        localStorage.setItem('hasShownLoginMessage', 'true');
        setTimeout(() => {
          loginSuccessMessage.classList.remove('show');
        }, 3000); // Duration for login success message (3 seconds)
      }
    }

    function logout() {
      // 1. Clear all relevant localStorage items immediately
      const userBeforeLogout = localStorage.getItem('loggedInUser'); // Capture the user before clearing 'loggedInUser'
      localStorage.removeItem('loggedInUser');
      localStorage.removeItem('hasShownLoginMessage');
      localStorage.removeItem('quizJustCompleted');
      localStorage.removeItem('quizStatus');
      localStorage.removeItem('lastQuizScore');
      localStorage.removeItem('lastQuizTotal');

      // Clear user-specific quiz history on logout (This can remain if you want to clear specific user quiz data on logout)
      if (userBeforeLogout) {
          localStorage.removeItem(`user_${userBeforeLogout}_quizzes`);
      }

      // 2. Show the logout success message
      // This will make it visible *before* the redirection occurs.
      logoutSuccessMessage.classList.add('show');

      // 3. Delay the redirection to allow the user to see the logout message
      // The message will be visible for this duration before the page changes.
      setTimeout(() => {
        window.location.href = "index.html";
      }, 2000); // Display for 2 seconds (adjust this duration as needed for logout message)
    }

    const quizData = [
      {
        question: "The figure given below is of Tobacco Mosaic Virus. Identify the label (a)",
        options: [
          "RNA",
          "dsDNA",
          "ssDNA",
          "Capsid"
        ],
        answer: "RNA",
        timeLimit: 60, // Default time limit
        imageUrl: "1.png", // Add this line for questions with images
        userAnswer: null,
        isCorrect: null
      },
      {
        question: "What is the function of the cell marked as (a)",
        options: [
          "Fix atmospheric oxygen",
          "Fix atmospheric nitrogen",
          "Fix atmospheric carbon dioxide",
          "Utilise sunlight"
        ],
        answer: "Fix atmospheric nitrogen",
        timeLimit: 60, // Default time limit
        imageUrl: "2.png", // Or simply omit the property if no image
        userAnswer: null,
        isCorrect: null
      },
      {
        question: "Mark the correct answer with relation to aestivation in the diagram",
        options: [
          "Valvate- Calotropis",
          "Twisted- China rose",
          "Valvate- China rose",
          "Twisted- Calotropis"
        ],
        answer: "Valvate- Calotropis",
        timeLimit: 60, // Default time limit
        imageUrl: "3.png", // Or simply omit the property if no image
        userAnswer: null,
        isCorrect: null
      },
      {
        question: "What is the common location of the type of epithelium that has been shown in the figure",
        options: [
          "Blood vessel",
          "Alveoli",
          "PCT",
          "Intestinal lining"
        ],
        answer: "PCT",
        timeLimit: 90, // Default time limit
        imageUrl: "4.png", // Or simply omit the property if no image
        userAnswer: null,
        isCorrect: null
      },
      {
        question: "The experiment demonstrated in the figure was carried out by",
        options: [
          "Engelmann",
          "Priestley",
          "Ingenhousz",
          "Von Sachs"
        ],
        answer: "Priestley",
        timeLimit: 60, // Default time limit
        imageUrl: "5.png", // Or simply omit the property if no image
        userAnswer: null,
        isCorrect: null
      },
      {
        question: "What is the function of structure labelled as (a)",
        options: [
          "Absorption of glucose",
          "Absorption of amino acids",
          "Absorption of fats",
          "Supply blood to villi"
        ],
        answer: "Absorption of fats",
        timeLimit: 60, // Default time limit
        imageUrl: "6.png", // Or simply omit the property if no image
        userAnswer: null,
        isCorrect: null
      },
      {
        question: "Which is the hormone synthesized by (a) part of pituitary",
        options: [
          "FSH",
          "TSH",
          "ADH",
          "None of these"
        ],
        answer: "None of these",
        timeLimit: 60, // Default time limit
        imageUrl: "7.png", // Or simply omit the property if no image
        userAnswer: null,
        isCorrect: null
      },
      {
        question: "What is happening to diaphragm in the given figure",
        options: [
          "Relaxation",
          "Contraction",
          "neither contraction nor relaxation",
          "First contraction then relaxation"
        ],
        answer: "Contraction",
        timeLimit: 60, // Default time limit
        imageUrl: "8.png", // Or simply omit the property if no image
        userAnswer: null,
        isCorrect: null
      },
      {
        question: "What is the site of action of ADH",
        options: [
          "PCT",
          "Descending limb of Loop of Henle",
          "Asending libm of Loop of Henle",
          "DCT"
        ],
        answer: "Asending libm of Loop of Henle",
        timeLimit: 60, // Default time limit
        imageUrl: "9.png", // Or simply omit the property if no image
        userAnswer: null,
        isCorrect: null
      },
            {
        question: "What is incorrect about (b)",
        options: [
          "When mature contain 2 cells",
          "Develops from microspore",
          "While developing, it derives nutrition ",
          "None of these"
        ],
        answer: "None of these",
        timeLimit: 60, // Default time limit
        imageUrl: "10.png", // Or simply omit the property if no image
        userAnswer: null,
        isCorrect: null
      },

    ];

    let currentQuestionIndex = 0;
    let score = 0;
    let wrongAnswers = 0;
    let skippedQuestionsCount = 0;
    let timer;
    let timeLeft;
    let questionAttempted = false;

    const quizDiv = document.getElementById('quiz');
    const feedbackDiv = document.getElementById('feedback');
    const submitBtn = document.getElementById('submitBtn');
    const skipBtn = document.getElementById('skipBtn');
    const nextBtn = document.getElementById('nextBtn');
    const timerDisplay = document.getElementById('timer');
    const quizContainer = document.getElementById('quizContainer');
    const finalScoreContainer = document.getElementById('finalScoreContainer');
    const finalScoreSpan = document.getElementById('finalScore');
    const totalQuestionsSpan = document.getElementById('totalQuestions');
    const quizInfoBox = document.getElementById('quizInfoBox');
    const startQuizBtn = document.getElementById('startQuizBtn');
    const infoTotalQuestions = document.getElementById('infoTotalQuestions');
    const infoTimePerQuestion = document.getElementById('infoTimePerQuestion');
    const quizResultsDetails = document.getElementById('quizResultsDetails');
    // const previousQuizzesContainer = document.getElementById('previousQuizzesContainer'); // Removed
    // const previousQuizList = document.getElementById('previousQuizList'); // Removed

    const finalCorrectAnswersSpan = document.getElementById('finalCorrectAnswers');
    const finalWrongAnswersSpan = document.getElementById('finalWrongAnswers');
    const finalSkippedQuestionsSpan = document.getElementById('finalSkippedQuestions');

    const progressBarFill = document.getElementById('progressBarFill');

    infoTotalQuestions.textContent = quizData.length;
    const averageTime = quizData.reduce((acc, q) => acc + q.timeLimit, 0) / quizData.length;
    infoTimePerQuestion.textContent = `${averageTime.toFixed(1)} (average)`;

    startQuizBtn.addEventListener('click', () => {
      quizInfoBox.style.display = 'none';
      quizContainer.style.display = 'block';
      welcomeMessageDiv.style.display = 'none';
      // Clear quiz status and last score when starting a new quiz
      localStorage.removeItem('quizStatus');
      localStorage.removeItem('lastQuizScore');
      localStorage.removeItem('lastQuizTotal');
      loadQuestion();
    });

    function startTimer() {
      clearInterval(timer);
      timeLeft = quizData[currentQuestionIndex].timeLimit;
      timerDisplay.textContent = `Time left: ${timeLeft}s`;
      timerDisplay.style.color = '#d9534f';

      timer = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = `Time left: ${timeLeft}s`;

        if (timeLeft <= 5 && timeLeft > 0) {
          timerDisplay.style.color = 'red';
        }

        if (timeLeft <= 0) {
          clearInterval(timer);
          feedbackDiv.textContent = "Time's up! The correct answer was: " + quizData[currentQuestionIndex].answer;
          feedbackDiv.classList.add('incorrect');
          disableOptions();
          submitBtn.style.display = 'none';
          skipBtn.style.display = 'none';
          questionAttempted = true;

          quizData[currentQuestionIndex].userAnswer = "Time's up!";
          quizData[currentQuestionIndex].isCorrect = false;
          wrongAnswers++;

          setTimeout(() => {
            if (currentQuestionIndex < quizData.length - 1) {
              nextQuestion();
            } else {
              showFinalScore();
            }
          }, 1500);
        }
      }, 1000);
    }

    function disableOptions() {
      const options = document.querySelectorAll('input[name="quizOption"]');
      options.forEach(option => {
        option.disabled = true;
      });
    }

    function enableOptions() {
      const options = document.querySelectorAll('input[name="quizOption"]');
      options.forEach(option => {
        option.disabled = false;
      });
    }

    function updateProgressBar() {
      let progress = (currentQuestionIndex / quizData.length) * 100;
      if (currentQuestionIndex === quizData.length) {
        progress = 100;
      }
      progressBarFill.style.width = `${progress}%`;
    }

    function loadQuestion() {
      questionAttempted = false;
      feedbackDiv.textContent = '';
      feedbackDiv.className = 'quiz-feedback';
      submitBtn.style.display = 'inline-block';
      skipBtn.style.display = 'inline-block';
      nextBtn.style.display = 'none';
      enableOptions();

      if (currentQuestionIndex < quizData.length) {
        const currentQuiz = quizData[currentQuestionIndex];
        let quizHTML = `<p class="quiz-question">${currentQuestionIndex + 1}. ${currentQuiz.question}</p>`;
        if (currentQuiz.imageUrl) {
            quizHTML += `<img src="${currentQuiz.imageUrl}" alt="Question Image" class="question-image">`;
        }
        quizHTML += `<div class="quiz-options">`;
        currentQuiz.options.forEach((option, index) => {
          quizHTML += `
            <label>
              <input type="radio" name="quizOption" value="${option}">
              ${option}
            </label>
          `;
        });
        quizHTML += `</div>`;
        quizDiv.innerHTML = quizHTML;
        startTimer();
        updateProgressBar();
      } else {
        showFinalScore();
      }
    }

    function submitAnswer() {
      if (questionAttempted) return;
      questionAttempted = true;

      clearInterval(timer);

      const selectedOption = document.querySelector('input[name="quizOption"]:checked');
      disableOptions();
      submitBtn.style.display = 'none';
      skipBtn.style.display = 'none';

      const currentQuestion = quizData[currentQuestionIndex];

      if (selectedOption) {
        const userAnswer = selectedOption.value;
        const correctAnswer = currentQuestion.answer;

        currentQuestion.userAnswer = userAnswer;

        if (userAnswer === correctAnswer) {
          feedbackDiv.textContent = "Correct!";
          feedbackDiv.classList.add('correct');
          score++;
          currentQuestion.isCorrect = true;
        } else {
          feedbackDiv.textContent = `Incorrect. The correct answer was: ${correctAnswer}`;
          feedbackDiv.classList.add('incorrect');
          wrongAnswers++;
          currentQuestion.isCorrect = false;
        }
      } else {
        feedbackDiv.textContent = `No answer selected. The correct answer was: ${currentQuestion.answer}`;
        feedbackDiv.className = 'quiz-feedback incorrect';
        currentQuestion.userAnswer = "No answer selected";
        currentQuestion.isCorrect = false;
        wrongAnswers++;
      }

      setTimeout(() => {
        if (currentQuestionIndex < quizData.length - 1) {
          nextQuestion();
        } else {
          showFinalScore();
        }
      }, 1500);
    }

    function skipQuestion() {
        if (questionAttempted) return;
        questionAttempted = true;

        clearInterval(timer);
        disableOptions();
        submitBtn.style.display = 'none';
        skipBtn.style.display = 'none';

        quizData[currentQuestionIndex].userAnswer = "Skipped";
        quizData[currentQuestionIndex].isCorrect = false;
        skippedQuestionsCount++;

        feedbackDiv.textContent = "Question skipped.";
        feedbackDiv.className = 'quiz-feedback';

        setTimeout(() => {
            if (currentQuestionIndex < quizData.length - 1) {
                nextQuestion();
            } else {
                showFinalScore();
            }
        }, 1500);
    }

    function nextQuestion() {
      currentQuestionIndex++;
      loadQuestion();
    }

    function saveQuizResult() {
        const loggedInUser = localStorage.getItem('loggedInUser');
        if (!loggedInUser) {
            console.error("No logged-in user found to save quiz result.");
            return;
        }

        const finalScoreCorrect = score;
        const totalQuizQuestions = quizData.length;

        // Create a deep copy of quizData to store with the result
        const quizDataForStorage = quizData.map(q => ({
            question: q.question,
            options: [...q.options], // Deep copy options array
            answer: q.answer,
            userAnswer: q.userAnswer,
            isCorrect: q.isCorrect,
            imageUrl: q.imageUrl // Include imageUrl in stored data
            // Do not store timeLimit if it's not relevant for past results display
        }));

        const newSubmission = {
            user: loggedInUser,
            score: `${finalScoreCorrect}/${totalQuizQuestions}`,
            numericScore: finalScoreCorrect,
            totalQuestions: totalQuizQuestions,
            wrongAnswers: wrongAnswers,
            skippedQuestionsCount: skippedQuestionsCount,
            timestamp: new Date().toLocaleString(),
            quizDetails: quizDataForStorage
        };

        // Save to global quizResults (for admin) - Keep this if you need a global record
        let adminQuizResults = JSON.parse(localStorage.getItem('quizResults')) || [];
        adminQuizResults.push(newSubmission);
        localStorage.setItem('quizResults', JSON.stringify(adminQuizResults));

        // The user-specific quiz history part is now commented out/removed as per requirement.
        // If you still want to store user-specific quiz results (even if not displayed by "Previous Quizzes" button),
        // you can keep this section. However, since the button and its display are removed,
        // I'm commenting this out for consistency.
        /*
        let userPreviousQuizzes = JSON.parse(localStorage.getItem(`user_${loggedInUser}_quizzes`)) || [];
        userPreviousQuizzes.push(newSubmission);
        localStorage.setItem(`user_${loggedInUser}_quizzes`, JSON.stringify(userPreviousQuizzes));
        */

        console.log(`Quiz result for ${loggedInUser} (${finalScoreCorrect}/${totalQuizQuestions}) saved.`);
    }

    function showFinalScore() {
      clearInterval(timer);
      quizContainer.style.display = 'none';
      quizInfoBox.style.display = 'none';
      welcomeMessageDiv.style.display = 'none';
      // previousQuizzesContainer.style.display = 'none'; // Removed this line

      finalScoreContainer.style.display = 'block';
      finalScoreSpan.textContent = score;
      totalQuestionsSpan.textContent = quizData.length;

      finalCorrectAnswersSpan.textContent = score;
      finalWrongAnswersSpan.textContent = wrongAnswers;
      finalSkippedQuestionsSpan.textContent = skippedQuestionsCount;

      updateProgressBar();

      saveQuizResult();

      localStorage.setItem('quizJustCompleted', 'true');
      localStorage.setItem('quizStatus', 'completed'); // Set quiz status
      localStorage.setItem('lastQuizScore', score); // Store last quiz score
      localStorage.setItem('lastQuizTotal', quizData.length); // Store last quiz total

      renderQuizResultsDetails(quizData); // Render detailed results for the just completed quiz
      quizResultsDetails.style.display = 'none'; // Keep detailed results hidden initially
    }

    // New function to show detailed results
    function showDetailedResults() {
        // Hide other main containers to show only detailed results
        quizInfoBox.style.display = 'none';
        quizContainer.style.display = 'none';
        finalScoreContainer.style.display = 'none';
        // previousQuizzesContainer.style.display = 'none'; // Removed this line
        welcomeMessageDiv.style.display = 'none';

        // Re-render the detailed results for the just completed quiz, if quizData is still in scope.
        // Assuming quizData still holds the results of the last completed quiz.
        renderQuizResultsDetails(quizData);
        quizResultsDetails.style.display = 'block'; // Show the detailed results
    }


    function renderQuizResultsDetails(dataToRender) {
      quizResultsDetails.innerHTML = '<h3>Detailed Results:</h3>';

      if (!dataToRender || dataToRender.length === 0) {
          quizResultsDetails.innerHTML += '<p>No detailed results available.</p>';
          return;
      }

      dataToRender.forEach((q, index) => {
        const resultItem = document.createElement('div');
        resultItem.classList.add('result-item');

        const questionP = document.createElement('p');
        questionP.classList.add('question');
        questionP.textContent = `${index + 1}. ${q.question}`;
        resultItem.appendChild(questionP);

        // Add image if available
        if (q.imageUrl) {
            const questionImage = document.createElement('img');
            questionImage.src = q.imageUrl;
            questionImage.alt = "Question Image";
            questionImage.classList.add('question-image');
            resultItem.appendChild(questionImage);
        }

        const yourAnswerP = document.createElement('p');
        yourAnswerP.textContent = `Your Answer: ${q.userAnswer}`;
        if (q.isCorrect === true) {
          yourAnswerP.classList.add('your-answer', 'correct');
        } else if (q.userAnswer === "Skipped") {
          yourAnswerP.classList.add('your-answer', 'skipped');
        } else {
          yourAnswerP.classList.add('your-answer');
        }
        resultItem.appendChild(yourAnswerP);

        if (q.isCorrect === false || q.userAnswer === "Skipped") {
          const correctAnswerP = document.createElement('p');
          correctAnswerP.classList.add('correct-answer');
          correctAnswerP.textContent = `Correct Answer: ${q.answer}`;
          resultItem.appendChild(correctAnswerP);
        }

        quizResultsDetails.appendChild(resultItem);
      });
    }

    function retakeQuiz() {
      currentQuestionIndex = 0;
      score = 0;
      wrongAnswers = 0;
      skippedQuestionsCount = 0;
      quizData.forEach(q => {
        q.userAnswer = null;
        q.isCorrect = null;
      });
      finalScoreContainer.style.display = 'none';
      quizResultsDetails.style.display = 'none';
      // previousQuizzesContainer.style.display = 'none'; // Removed this line
      quizInfoBox.style.display = 'block';
      welcomeMessageDiv.style.display = 'block';
      localStorage.removeItem('quizJustCompleted');
      localStorage.removeItem('quizStatus'); // Clear quiz status when retaking
      localStorage.removeItem('lastQuizScore'); // Clear last quiz score when retaking
      localStorage.removeItem('lastQuizTotal'); // Clear last quiz total when retaking
      updateQuizInfoBox(); // Update info box to default state
      updateProgressBar();
    }

    // Removed showPreviousQuizzes function and related load/view/delete functions
    /*
    function showPreviousQuizzes() {
        quizInfoBox.style.display = 'none';
        quizContainer.style.display = 'none';
        finalScoreContainer.style.display = 'none';
        quizResultsDetails.style.display = 'none'; // Ensure detailed results are hidden
        welcomeMessageDiv.style.display = 'none';
        localStorage.removeItem('quizJustCompleted');
        localStorage.removeItem('quizStatus'); // Clear quiz status if viewing previous quizzes
        localStorage.removeItem('lastQuizScore'); // Clear last quiz score
        localStorage.removeItem('lastQuizTotal'); // Clear last quiz total

        previousQuizzesContainer.style.display = 'block';
        updateQuizInfoBox(); // Update info box to default state if coming from previous quizzes
        loadPreviousQuizzes();
    }

    function loadPreviousQuizzes() {
        const loggedInUser = localStorage.getItem('loggedInUser');
        const userPreviousQuizzes = JSON.parse(localStorage.getItem(`user_${loggedInUser}_quizzes`)) || [];
        previousQuizList.innerHTML = ''; // Clear existing entries

        if (userPreviousQuizzes.length === 0) {
            previousQuizList.innerHTML = '<p class="no-previous-quizzes">You have not completed any quizzes yet.</p>';
            return;
        }

        userPreviousQuizzes.forEach((quiz, index) => {
            const quizEntry = document.createElement('div');
            quizEntry.classList.add('quiz-entry');
            quizEntry.innerHTML = `
                <p>Quiz ${index + 1}: Score ${quiz.score} (Correct: ${quiz.numericScore}, Wrong: ${quiz.wrongAnswers}, Skipped: ${quiz.skippedQuestionsCount}) - ${quiz.timestamp}</p>
                <div class="action-buttons">
                    <button class="view-details-btn" onclick="viewPreviousQuizDetails(${index})">View Details</button>
                    <button class="delete-details-btn" onclick="deletePreviousQuizEntry(${index})">Delete Details</button>
                </div>
            `;
            previousQuizList.appendChild(quizEntry);
        });
    }

    function viewPreviousQuizDetails(index) {
        const loggedInUser = localStorage.getItem('loggedInUser');
        const userPreviousQuizzes = JSON.parse(localStorage.getItem(`user_${loggedInUser}_quizzes`)) || [];

        if (index >= 0 && index < userPreviousQuizzes.length) {
            const selectedQuiz = userPreviousQuizzes[index];

            quizInfoBox.style.display = 'none';
            quizContainer.style.display = 'none';
            finalScoreContainer.style.display = 'none';
            previousQuizzesContainer.style.display = 'none';
            welcomeMessageDiv.style.display = 'none';
            localStorage.removeItem('quizJustCompleted');
            localStorage.removeItem('quizStatus'); // Clear quiz status if viewing details
            localStorage.removeItem('lastQuizScore'); // Clear last quiz score
            localStorage.removeItem('lastQuizTotal'); // Clear last quiz total

            renderQuizResultsDetails(selectedQuiz.quizDetails);
            quizResultsDetails.style.display = 'block';
            updateQuizInfoBox(); // Update info box to default state if coming from details
        } else {
            console.error("Invalid quiz index for viewing details.");
        }
    }

    function deletePreviousQuizEntry(index) {
        if (!confirm("Are you sure you want to delete this quiz entry? This action cannot be undone.")) {
            return; // Stop if user cancels
        }

        const loggedInUser = localStorage.getItem('loggedInUser');
        let userPreviousQuizzes = JSON.parse(localStorage.getItem(`user_${loggedInUser}_quizzes`)) || [];

        if (index >= 0 && index < userPreviousQuizzes.length) {
            const deletedQuiz = userPreviousQuizzes.splice(index, 1)[0]; // Remove the entry and get it

            localStorage.setItem(`user_${loggedInUser}_quizzes`, JSON.stringify(userPreviousQuizzes));
            console.log(`Quiz entry ${index} deleted for user ${loggedInUser}.`);

            // Optional: Also delete from global 'quizResults' for admin view if a perfect match is found
            let adminQuizResults = JSON.parse(localStorage.getItem('quizResults')) || [];
            const initialAdminCount = adminQuizResults.length;
            adminQuizResults = adminQuizResults.filter(quiz =>
                !(quiz.user === deletedQuiz.user &&
                  quiz.score === deletedQuiz.score &&
                  quiz.timestamp === deletedQuiz.timestamp &&
                  quiz.numericScore === deletedQuiz.numericScore)
            );
            if (adminQuizResults.length < initialAdminCount) {
                localStorage.setItem('quizResults', JSON.stringify(adminQuizResults));
                console.log("Corresponding entry removed from admin quiz results.");
            }
            loadPreviousQuizzes(); // Reload the list to reflect the deletion
        } else {
            console.error("Invalid quiz index for deletion.");
        }
    }
    */

    function updateQuizInfoBox() {
        const quizStatus = localStorage.getItem('quizStatus');
        const lastScore = localStorage.getItem('lastQuizScore');
        const lastTotal = localStorage.getItem('lastQuizTotal');

        if (quizStatus === 'completed' && lastScore !== null && lastTotal !== null) {
            quizInfoHeading.textContent = "Last Quiz Completed!";
            lastQuizScoreSpan.textContent = lastScore;
            lastQuizTotalQuestionsSpan.textContent = lastTotal;
            lastQuizScoreDisplay.style.display = 'block';
        } else {
            quizInfoHeading.textContent = "Welcome to the Quiz!";
            lastQuizScoreDisplay.style.display = 'none';
        }
    }

    function goToDashboard() {
        quizContainer.style.display = 'none';
        finalScoreContainer.style.display = 'none';
        quizResultsDetails.style.display = 'none';
        // previousQuizzesContainer.style.display = 'none'; // Removed this line

        quizInfoBox.style.display = 'block';
        welcomeMessageDiv.style.display = 'block';

        // Check if a quiz was just completed and show message
        const quizJustCompleted = localStorage.getItem('quizJustCompleted');
        if (quizJustCompleted === 'true') {
            quizCompletedMessage.classList.add('show');
            localStorage.removeItem('quizJustCompleted');
            setTimeout(() => {
                quizCompletedMessage.classList.remove('show');
            }, 3000);
        }

        updateQuizInfoBox(); // Update the info box content
    }


    // Initial setup: Hide specific quiz sections on load
    quizContainer.style.display = 'none';
    finalScoreContainer.style.display = 'none';
    quizResultsDetails.style.display = 'none';
    // previousQuizzesContainer.style.display = 'none'; // Removed this line
    quizInfoBox.style.display = 'block';
    updateProgressBar();
    updateQuizInfoBox(); // Call on initial load to reflect previous completion
  </script>

</body>
</html>
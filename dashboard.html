<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="linkup.png">
  <title>Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* Global Styles */
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f2f5;
      color: #333;
      display: flex; /* Make body a flex container */
      min-height: 100vh; /* Ensure body takes full viewport height */
    }

    /* Navigation Bar - Left Sidebar */
    nav {
      background-color: #46aa8c;
      color: white;
      padding: 25px 15px; /* Adjust padding for vertical layout */
      display: flex;
      flex-direction: column; /* Stack items vertically */
      justify-content: flex-start; /* Align items to the top */
      align-items: flex-start; /* Align items to the left */
      box-shadow: 2px 0 10px rgba(0,0,0,0.3);
      width: 200px; /* Fixed width for the sidebar */
      flex-shrink: 0; /* Prevent shrinking */
    }

    nav .logo-container {
        text-align: center;
        margin-bottom: 30px;
        width: 100%; /* Ensure logo container takes full width */
    }

    nav .logo {
        max-width: 120px; /* Adjust logo size */
        height: auto;
        border-radius: 8px; /* Slightly rounded corners for the logo */
    }

    nav ul {
      list-style: none;
      padding: 0;
      width: 100%; /* Full width for list */
    }

    nav ul li {
      margin-bottom: 15px;
    }

    nav ul li a {
      color: white;
      text-decoration: none;
      padding: 10px 15px;
      display: block;
      border-radius: 8px;
      transition: background-color 0.3s ease;
      font-size: 1.1em;
      font-weight: 500;
    }

    nav ul li a:hover,
    nav ul li a.active {
      background-color: #3a8a71;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* Main Content Area */
    .main-content {
      flex-grow: 1; /* Allow content to take remaining space */
      padding: 30px;
      overflow-y: auto; /* Enable scrolling for content */
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e0e0e0;
    }

    header h1 {
      color: #333;
      font-size: 2.2em;
      margin: 0;
    }

    .user-info {
      display: flex;
      align-items: center;
    }

    .user-info span {
      margin-right: 15px;
      font-weight: 600;
      color: #555;
    }

    .user-info button {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 600;
      transition: background-color 0.3s ease, transform 0.2s ease;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .user-info button:hover {
      background-color: #c82333;
      transform: translateY(-1px);
    }

    /* Welcome Message */
    .welcome-message {
        background-color: #d4edda; /* Light green for success */
        color: #155724; /* Dark green text */
        padding: 15px 25px;
        border-radius: 8px;
        margin-bottom: 25px;
        font-size: 1.1em;
        font-weight: 500;
        border: 1px solid #c3e6cb;
        opacity: 0; /* Hidden by default */
        transform: translateY(-20px);
        transition: opacity 0.5s ease-out, transform 0.5s ease-out;
    }

    .welcome-message.show {
        opacity: 1;
        transform: translateY(0);
    }

    /* Quiz Info Box */
    .quiz-info-box {
        background: #ffffff;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        text-align: center;
        margin-bottom: 30px;
        border: 1px solid #e0e0e0;
    }

    .quiz-info-box h2 {
        color: #007bff;
        margin-bottom: 15px;
        font-size: 1.8em;
    }

    .quiz-info-box p {
        color: #555;
        font-size: 1.1em;
        line-height: 1.6;
        margin-bottom: 20px;
    }

    .quiz-info-box button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1em;
        font-weight: 600;
        transition: background-color 0.3s ease, transform 0.2s ease;
        box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
    }

    .quiz-info-box button:hover {
        background-color: #0056b3;
        transform: translateY(-1px);
    }

    /* Quiz Container */
    .quiz-container {
      background: #ffffff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      border: 1px solid #e0e0e0;
      display: none; /* Hidden by default */
    }

    .quiz-container h2 {
      color: #007bff;
      margin-bottom: 20px;
      text-align: center;
      font-size: 2em;
    }

    .progress-bar-container {
      width: 100%;
      background-color: #e0e0e0;
      border-radius: 10px;
      margin-bottom: 25px;
      height: 18px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background-color: #28a745;
      border-radius: 10px;
      transition: width 0.4s ease-in-out;
      text-align: center;
      color: white;
      font-size: 0.8em;
      line-height: 18px; /* Vertically center text */
    }

    .question-image {
        max-width: 80%;
        height: auto;
        display: block;
        margin: 15px auto 25px auto; /* Center the image and add vertical spacing */
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .question {
      font-size: 1.4em;
      color: #333;
      margin-bottom: 25px;
      line-height: 1.5;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .option {
      background-color: #f8f8f8;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.2s ease;
      font-size: 1.1em;
      text-align: left;
      color: #444;
      display: flex;
      align-items: center;
    }

    .option:hover {
      background-color: #e9f7ff;
      border-color: #007bff;
      transform: translateY(-2px);
    }

    .option.selected {
      background-color: #e0f2fe; /* Light blue for selected */
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
    }

    .option.correct {
        background-color: #d4edda; /* Light green for correct */
        border-color: #28a745;
        color: #155724;
    }

    .option.wrong {
        background-color: #f8d7da; /* Light red for wrong */
        border-color: #dc3545;
        color: #721c24;
    }

    .quiz-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      gap: 15px;
    }

    .quiz-navigation button {
      background-color: #6c757d;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      transition: background-color 0.3s ease, transform 0.2s ease;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .quiz-navigation button:hover {
      background-color: #5a6268;
      transform: translateY(-1px);
    }

    .quiz-navigation button#nextButton,
    .quiz-navigation button#submitButton {
        background-color: #007bff;
    }

    .quiz-navigation button#nextButton:hover,
    .quiz-navigation button#submitButton:hover {
        background-color: #0056b3;
    }

    button:disabled {
        background-color: #cccccc !important;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
    }

    /* Timer specific styles */
    .timer-container {
        text-align: center;
        margin-bottom: 20px;
        font-size: 1.8em; /* Slightly larger font */
        font-weight: bold;
        color: #dc3545; /* Red color for urgency */
        background-color: #ffebeb; /* Light red background */
        border: 2px solid #dc3545; /* Red border */
        border-radius: 10px; /* Rounded corners */
        padding: 10px 20px; /* Add some padding */
        box-shadow: 0 4px 10px rgba(220, 53, 69, 0.2); /* Subtle shadow */
        display: inline-block; /* Shrink to fit content */
        min-width: 150px; /* Minimum width */
        transition: all 0.3s ease-in-out; /* Smooth transitions for hover/state changes */
    }

    .timer-container.warning {
        color: #ffc107; /* Orange for warning */
        background-color: #fff3cd;
        border-color: #ffc107;
        box-shadow: 0 4px 10px rgba(255, 193, 7, 0.2);
    }

    .timer-container.critical {
        color: #f00; /* Bright red for critical */
        background-color: #ffe0e0;
        border-color: #f00;
        animation: pulse 1s infinite; /* Pulsing animation for critical time */
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }


    /* Final Score Container */
    .final-score-container {
        background: #ffffff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        text-align: center;
        border: 1px solid #e0e0e0;
        display: none; /* Hidden by default */
    }

    .final-score-container h2 {
        color: #28a745; /* Green for success */
        font-size: 2.5em;
        margin-bottom: 15px;
    }

    .final-score-container p {
        font-size: 1.2em;
        color: #555;
        margin-bottom: 25px;
    }

    .final-score-container button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1em;
        font-weight: 600;
        transition: background-color 0.3s ease, transform 0.2s ease;
        box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
        margin: 0 10px; /* Space between buttons */
    }

    .final-score-container button:hover {
        background-color: #0056b3;
        transform: translateY(-1px);
    }

    /* Quiz Results Details (Dashboard) */
    .quiz-results-details {
        margin-top: 30px;
        padding: 30px;
        border-radius: 12px;
        background-color: #ffffff;
        box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        text-align: left;
        border: 1px solid #e0e0e0;
        display: none; /* Hidden by default */
    }
    .quiz-results-details h3 {
        color: #007bff;
        margin-bottom: 20px;
        text-align: center;
        font-size: 1.8em;
        border-bottom: 2px solid #eaf5ff;
        padding-bottom: 10px;
    }
    .quiz-results-details .result-item {
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px dashed #ddd;
    }
    .quiz-results-details .result-item:last-child {
        border-bottom: none;
    }
    .quiz-results-details .question {
        font-weight: bold;
        margin-bottom: 8px;
        font-size: 1.25em;
        color: #555;
    }
    .quiz-results-details .your-answer {
        color: #d9534f;
        font-style: italic;
        margin-left: 10px;
        font-size: 1.1em;
    }
    .quiz-results-details .correct-answer {
        color: #28a745;
        font-weight: bold;
        margin-left: 10px;
        font-size: 1.1em;
    }
    .quiz-results-details .your-answer.correct {
        color: #28a745;
    }
    .quiz-results-details .your-answer.skipped {
        color: #ffc107;
        font-weight: bold;
    }

    /* Style for View Details Button in Previous Quizzes Table */
    .previous-quiz-view-btn {
        background-color: #28a745; /* A pleasant green */
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 500;
        transition: background-color 0.3s ease, transform 0.2s ease;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .previous-quiz-view-btn:hover {
        background-color: #218838; /* Darker green on hover */
        transform: translateY(-1px);
    }

    /* New style for the "Back to Score" button */
    .back-to-score-btn {
        background-color: #007bff; /* Blue */
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 20px; /* Slightly more rounded */
        cursor: pointer;
        font-size: 1em;
        font-weight: 600;
        transition: background-color 0.3s ease, transform 0.2s ease;
        box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
        margin-top: 20px; /* Add some space above it */
    }

    .back-to-score-btn:hover {
        background-color: #0056b3; /* Darker blue on hover */
        transform: translateY(-1px);
    }

  </style>
</head>
<body>
  <nav>
    <div class="logo-container">
        <img src="linkup.png" alt="LinkUp Logo" class="logo">
    </div>
    <ul>
      <li><a href="#" id="dashboardLink" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
      <li><a href="#" id="startQuizLink"><i class="fas fa-play-circle"></i> Start Quiz</a></li>
      <li><a href="#" id="previousQuizzesLink"><i class="fas fa-history"></i> Previous Quizzes</a></li>
      <li><a href="#" id="logoutLink"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
    </ul>
  </nav>

  <div class="main-content">
    <header>
      <h1 id="welcomeHeading"></h1>
      <div class="user-info">
        <span id="usernameDisplay"></span>
        <button id="headerLogoutButton">Logout</button>
      </div>
    </header>

    <div class="welcome-message" id="loginSuccessMessage">
        You have successfully logged in!
    </div>

    <div class="welcome-message" id="quizCompletedMessage">
        Quiz completed successfully!
    </div>

    <div class="quiz-info-box" id="quizInfoBox">
        <h2 id="quizInfoHeading">Welcome to the Quiz!</h2>
        <p>Test your knowledge with our exciting quizzes. Click the button below to start your first quiz.</p>
        <p id="lastQuizScoreDisplay" style="display:none;"></p>
        <button id="startQuizButton">Start New Quiz</button>
    </div>

    <div class="quiz-container" id="quizContainer">
      <h2 id="quizTitle"></h2>
      <div class="timer-container" id="timerDisplay">Time Left: --s</div> <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar">0%</div>
      </div>
      <img id="questionImage" class="question-image" src="" alt="Question Image" style="display:none;">
      <p class="question" id="questionText"></p>
      <div class="options" id="optionsContainer">
        </div>
      <div class="quiz-navigation">
        <button id="prevButton" disabled>Previous</button>
        <button id="skipButton">Skip</button>
        <button id="nextButton">Next</button>
        <button id="submitButton" style="display:none;">Submit Quiz</button>
      </div>
    </div>

    <div class="final-score-container" id="finalScoreContainer">
      <h2>Quiz Completed!</h2>
      <p>Your Score: <span id="scoreDisplay"></span></p>
      <p>Correct Answers: <span id="correctAnswersCount"></span></p>
      <p>Wrong Answers: <span id="wrongAnswersCount"></span></p>
      <p>Skipped Questions: <span id="skippedQuestionsCount"></span></p>
      <p>Percentage: <span id="percentageScore"></span></p>
      <button id="viewResultsButton">View My Answers</button>
      <button id="returnToDashboardButton">Return to Dashboard</button>
    </div>

    <div class="quiz-results-details" id="quizResultsDetails">
        <h3>Detailed Results:</h3>
        <button class="back-to-score-btn" onclick="backToFinalScore()">Back to Score</button>
    </div>

    <div id="previousQuizzesContainer" style="display:none;">
        <h2>My Previous Quizzes</h2>
        <p id="noPreviousQuizzesMessage" style="display:none; text-align: center; font-style: italic; color: #777;">No previous quiz data found.</p>
        <table id="previousQuizzesTable" style="width:100%; border-collapse: collapse; margin-top: 20px;">
            <thead>
                <tr>
                    <th style="border: 1px solid #ddd; padding: 12px; text-align: left; background-color: #46aa8c; color: white;">Quiz Name</th>
                    <th style="border: 1px solid #ddd; padding: 12px; text-align: left; background-color: #46aa8c; color: white;">Score</th>
                    <th style="border: 1px solid #ddd; padding: 12px; text-align: left; background-color: #46aa8c; color: white;">Percentage</th>
                    <th style="border: 1px solid #ddd; padding: 12px; text-align: left; background-color: #46aa8c; color: white;">Date/Time</th>
                    <th style="border: 1px solid #ddd; padding: 12px; text-align: left; background-color: #46aa8c; color: white;">Actions</th>
                </tr>
            </thead>
            <tbody id="previousQuizzesTableBody">
            </tbody>
        </table>
    </div>

  </div>

  <script>
    const quizInfoBox = document.getElementById('quizInfoBox');
    const quizContainer = document.getElementById('quizContainer');
    const finalScoreContainer = document.getElementById('finalScoreContainer');
    const quizResultsDetails = document.getElementById('quizResultsDetails'); // Detailed results container
    const previousQuizzesContainer = document.getElementById('previousQuizzesContainer'); // Previous quizzes list

    const startQuizButton = document.getElementById('startQuizButton');
    const quizTitle = document.getElementById('quizTitle');
    const questionText = document.getElementById('questionText');
    const questionImage = document.getElementById('questionImage');
    const optionsContainer = document.getElementById('optionsContainer');
    const prevButton = document.getElementById('prevButton');
    const skipButton = document.getElementById('skipButton');
    const nextButton = document.getElementById('nextButton');
    const submitButton = document.getElementById('submitButton');
    const progressBar = document.getElementById('progressBar');
    const timerDisplay = document.getElementById('timerDisplay'); // Timer display element

    const scoreDisplay = document.getElementById('scoreDisplay');
    const correctAnswersCount = document.getElementById('correctAnswersCount');
    const wrongAnswersCount = document.getElementById('wrongAnswersCount');
    const skippedQuestionsCount = document.getElementById('skippedQuestionsCount');
    const percentageScore = document.getElementById('percentageScore');
    const viewResultsButton = document.getElementById('viewResultsButton');
    const returnToDashboardButton = document.getElementById('returnToDashboardButton');

    const dashboardLink = document.getElementById('dashboardLink');
    const startQuizLink = document.getElementById('startQuizLink');
    const previousQuizzesLink = document.getElementById('previousQuizzesLink');
    const logoutLink = document.getElementById('logoutLink');
    const headerLogoutButton = document.getElementById('headerLogoutButton');

    const welcomeHeading = document.getElementById('welcomeHeading');
    const usernameDisplay = document.getElementById('usernameDisplay');
    const loginSuccessMessage = document.getElementById('loginSuccessMessage');
    const quizCompletedMessage = document.getElementById('quizCompletedMessage');
    const quizInfoHeading = document.getElementById('quizInfoHeading');
    const lastQuizScoreDisplay = document.getElementById('lastQuizScoreDisplay');
    const welcomeMessageDiv = document.querySelector('.welcome-message'); // For initial login message

    let currentQuiz = null;
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let correctAnswersTotal = 0;
    let wrongAnswersTotal = 0;
    let skippedQuestionsTotal = 0;
    let quizDetailsForDisplay = []; // To store question, user answer, correct answer, and correctness

    // Timer variables
    let timeLeft = 0; // Initialize to 0, will be set when loading a question
    let timerInterval;

    // --- Authentication and Initial Load ---
    document.addEventListener('DOMContentLoaded', (event) => {
        const loggedInUser = localStorage.getItem('loggedInUser');
        if (!loggedInUser) {
            window.location.href = "index.html"; // Redirect to login if not logged in
        } else {
            usernameDisplay.textContent = loggedInUser;
            welcomeHeading.textContent = `Welcome, ${loggedInUser}!`;
            
            // Show login success message only once per login session
            const hasShownLoginMessage = localStorage.getItem('hasShownLoginMessage');
            if (hasShownLoginMessage === 'false') {
                loginSuccessMessage.classList.add('show');
                localStorage.setItem('hasShownLoginMessage', 'true');
                setTimeout(() => {
                    loginSuccessMessage.classList.remove('show');
                }, 3000);
            }
            goToDashboard(); // Show dashboard by default
        }
    });

    logoutLink.addEventListener('click', logout);
    headerLogoutButton.addEventListener('click', logout);

    function logout() {
        localStorage.removeItem('loggedInUser');
        localStorage.removeItem('hasShownLoginMessage'); // Clear this on logout
        window.location.href = "index.html";
    }

    // --- Navigation ---
    dashboardLink.addEventListener('click', (e) => {
        e.preventDefault();
        setActiveLink(dashboardLink);
        goToDashboard();
    });

    startQuizLink.addEventListener('click', (e) => {
        e.preventDefault();
        setActiveLink(startQuizLink);
        showStartQuizSection();
    });

    previousQuizzesLink.addEventListener('click', (e) => {
        e.preventDefault();
        setActiveLink(previousQuizzesLink);
        showPreviousQuizzesSection();
    });

    function setActiveLink(activeLink) {
        document.querySelectorAll('nav ul li a').forEach(link => {
            link.classList.remove('active');
        });
        activeLink.classList.add('active');
    }

    // --- Quiz Data (Example Quizzes) ---
    const quizzes = [
        {
            name: "Biology Class 11/12",
            questions: [
                {
                    question: "The figure given below is of Tobacco Mosaic Virus. Identify the label (a)",
                    options: [
                    "RNA",
                    "dsDNA", 
                    "ssDNA", 
                    "Capsid"],
                    answer: "RNA",
                    imageUrl: "1.png", // No image for this question
                    timeLimit: 60 // Added time limit for this question
                },
                {
                    question: "What is the function of the cell marked as (a)",
                    options: [
                        "Fixed atmospheric oxygen", 
                        "Fix atmospheric nitrogen", 
                        "fix atmospheric carbon dioxide", 
                        "Utilise sunlight"],
                    answer: "Fix atmospheric nitrogen",
                    imageUrl: "2.png",
                    timeLimit: 60 // Added time limit for this question
                },
                {
                    question: "Mark the correct answer with relation to aestivation in the diagram",
                    options: [
                    "Valvate- Calotropis", 
                    "Twisted- China rose", 
                    "Valvate- China rose", 
                    "twisted- Calotropis"],
                    answer: "Valvate- Calotropis",
                    imageUrl: "3.png",
                    timeLimit: 60 // Added time limit for this question
                },
                {
                    question: "The experiment demonstrated in the figure was carried out by",
                    options: [
                    "Engelmann", 
                    "Priestley", 
                    "Ingenhousz", 
                    "Von Sachs"],
                    answer: "Priestley",
                    imageUrl: "5.png",
                    timeLimit: 60 // Added time limit for this question
                },
                {
                    question: "What is the function of structured labelled as(a)",
                    options: [
                    "Absorption of glucose", 
                    "Absorption ofamino acid", 
                    "Absorption of fats", 
                    "Supply blood to villi"],
                    answer: "Absorption of fats",
                    imageUrl: "6.png",
                    timeLimit: 60 // Added time limit for this question
                },
                {
                    question: "Which is the hormone synthesized by (a) part of pituitary",
                    options: [
                    "FSH", 
                    "TSH", 
                    "ADH", 
                    "None of these"],
                    answer: "None of these",
                    imageUrl: "7.png",
                    timeLimit: 60 // Added time limit for this question
                },
                {
                    question: "What is happening to diaphragm in the given figure",
                    options: [
                    "Relaxation", 
                    "Contraction", 
                    "Neither contraction nor relaxation", 
                    "first contraction then relaxation"],
                    answer: "Contraction",
                    imageUrl: "8.png",
                    timeLimit: 60 // Added time limit for this question
                },
                {
                    question: "What is the site of action of ADH",
                    options: [
                    "PCT", 
                    "Descending libm of loop of Henle", 
                    "Ascending limb of Loop Henle", 
                    "DCT"],
                    answer: "DCT",
                    imageUrl: "9.png",
                    timeLimit: 60 // Added time limit for this question
                },
                {
                    question: "Mark the option with correct label",
                    options: [
                    "Secondary follicle", 
                    "Tertiary follicle", 
                    "Corpusluteum", 
                    "Graafian follicle"],
                    answer: "Tertiary follicle",
                    imageUrl: "10.png",
                    timeLimit: 60 // Added time limit for this question
                },




            ]
        },
    ];

    // --- Quiz Flow Functions ---
    startQuizButton.addEventListener('click', startRandomQuiz);

    function startRandomQuiz() {
        if (quizzes.length === 0) {
            alert("No quizzes available to start!");
            return;
        }
        const randomIndex = Math.floor(Math.random() * quizzes.length);
        currentQuiz = quizzes[randomIndex];
        currentQuestionIndex = 0;
        userAnswers = Array(currentQuiz.questions.length).fill(null); // Initialize user answers with null
        correctAnswersTotal = 0;
        wrongAnswersTotal = 0;
        skippedQuestionsTotal = 0;
        quizDetailsForDisplay = []; // Clear previous quiz details

        quizInfoBox.style.display = 'none';
        finalScoreContainer.style.display = 'none';
        quizResultsDetails.style.display = 'none';
        previousQuizzesContainer.style.display = 'none';
        quizContainer.style.display = 'block';

        quizTitle.textContent = currentQuiz.name;
        loadQuestion();
        updateProgressBar();
    }

    function startTimer() {
        clearInterval(timerInterval); // Clear any existing timer

        const question = currentQuiz.questions[currentQuestionIndex];
        timeLeft = question.timeLimit; // Set timeLeft to the current question's timeLimit

        // Initial update of display and class
        timerDisplay.textContent = `Time Left: ${timeLeft}s`;
        timerDisplay.classList.remove('warning', 'critical');
        if (timeLeft <= 10 && timeLeft > 5) { // Example: Warning for last 10 seconds
            timerDisplay.classList.add('warning');
        } else if (timeLeft <= 5) { // Example: Critical for last 5 seconds
            timerDisplay.classList.add('critical');
        }


        timerInterval = setInterval(() => {
            timeLeft--;
            timerDisplay.textContent = `Time Left: ${timeLeft}s`;

            // Update classes based on time left
            timerDisplay.classList.remove('warning', 'critical'); // Remove previous states
            if (timeLeft <= 10 && timeLeft > 5) { // Example: Warning for last 10 seconds
                timerDisplay.classList.add('warning');
            } else if (timeLeft <= 5) { // Example: Critical for last 5 seconds
                timerDisplay.classList.add('critical');
            }

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                // Automatically move to the next question or submit if it's the last one
                if (userAnswers[currentQuestionIndex] === null) {
                    userAnswers[currentQuestionIndex] = "Time Out"; // Mark as time out
                }
                if (currentQuestionIndex < currentQuiz.questions.length - 1) {
                    currentQuestionIndex++;
                    loadQuestion();
                    updateProgressBar();
                } else {
                    submitQuiz();
                }
            }
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval);
    }


    function loadQuestion() {
        stopTimer(); // Stop timer before loading new question
        const question = currentQuiz.questions[currentQuestionIndex];
        questionText.textContent = question.question;
        optionsContainer.innerHTML = ''; // Clear previous options

        if (question.imageUrl) {
            questionImage.src = question.imageUrl;
            questionImage.style.display = 'block';
        } else {
            questionImage.style.display = 'none';
        }

        question.options.forEach((option, index) => {
            const optionDiv = document.createElement('div');
            optionDiv.classList.add('option');
            optionDiv.textContent = option;
            optionDiv.addEventListener('click', () => selectOption(index));

            // If user has already answered this question, show their selection
            if (userAnswers[currentQuestionIndex] === option) {
                optionDiv.classList.add('selected');
            }
            optionsContainer.appendChild(optionDiv);
        });

        updateNavigationButtons();
        startTimer(); // Start timer for the new question
    }

    function selectOption(selectedIndex) {
        stopTimer(); // Stop timer when an option is selected
        const options = optionsContainer.querySelectorAll('.option');
        options.forEach((option, index) => {
            option.classList.remove('selected');
            if (index === selectedIndex) {
                option.classList.add('selected');
                userAnswers[currentQuestionIndex] = options[selectedIndex].textContent;
            }
        });
    }

    function updateNavigationButtons() {
        prevButton.disabled = currentQuestionIndex === 0;
        nextButton.style.display = currentQuestionIndex < currentQuiz.questions.length - 1 ? 'inline-block' : 'none';
        skipButton.style.display = currentQuestionIndex < currentQuiz.questions.length - 1 ? 'inline-block' : 'none';
        submitButton.style.display = currentQuestionIndex === currentQuiz.questions.length - 1 ? 'inline-block' : 'none';
    }

    nextButton.addEventListener('click', () => {
        stopTimer(); // Stop timer when moving to next question
        if (currentQuestionIndex < currentQuiz.questions.length - 1) {
            currentQuestionIndex++;
            loadQuestion();
            updateProgressBar();
        }
    });

    prevButton.addEventListener('click', () => {
        stopTimer(); // Stop timer when moving to previous question
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            loadQuestion();
            updateProgressBar();
        }
    });

    skipButton.addEventListener('click', () => {
        stopTimer(); // Stop timer when skipping
        if (userAnswers[currentQuestionIndex] === null) { // Only mark as skipped if not already answered/timed out
            userAnswers[currentQuestionIndex] = "Skipped"; // Mark as skipped
        }
        
        if (currentQuestionIndex < currentQuiz.questions.length - 1) {
            currentQuestionIndex++;
            loadQuestion();
            updateProgressBar();
        } else {
            // If skipped on the last question, submit
            submitQuiz();
        }
    });

    submitButton.addEventListener('click', () => {
        stopTimer(); // Stop timer on submit
        submitQuiz();
    });

    function updateProgressBar() {
        const progress = ((currentQuestionIndex + 1) / currentQuiz.questions.length) * 100;
        progressBar.style.width = `${progress}%`;
        progressBar.textContent = `${Math.round(progress)}%`;
    }

    function submitQuiz() {
        stopTimer(); // Ensure timer is stopped when quiz is submitted
        correctAnswersTotal = 0;
        wrongAnswersTotal = 0;
        skippedQuestionsTotal = 0;
        quizDetailsForDisplay = []; // Clear for new submission

        currentQuiz.questions.forEach((question, index) => {
            const userAnswer = userAnswers[index];
            const isCorrect = (userAnswer === question.answer);

            if (userAnswer === question.answer) {
                correctAnswersTotal++;
            } else if (userAnswer === "Skipped" || userAnswer === "Time Out") { // Account for "Time Out" as skipped
                skippedQuestionsTotal++;
            } else {
                wrongAnswersTotal++;
            }

            quizDetailsForDisplay.push({
                question: question.question,
                imageUrl: question.imageUrl,
                userAnswer: userAnswer || "Not Answered", // Handle cases where user might not select and not skip
                answer: question.answer,
                isCorrect: isCorrect
            });
        });

        displayFinalScore();
        saveQuizResult();

        localStorage.setItem('quizJustCompleted', 'true');
        updateQuizInfoBox(); // Update dashboard with latest score
    }

    function displayFinalScore() {
        quizContainer.style.display = 'none';
        finalScoreContainer.style.display = 'block';
        quizResultsDetails.style.display = 'none';
        previousQuizzesContainer.style.display = 'none';
        quizInfoBox.style.display = 'none'; // Hide info box when showing score

        const totalQuestions = currentQuiz.questions.length;
        scoreDisplay.textContent = `${correctAnswersTotal} / ${totalQuestions}`;
        correctAnswersCount.textContent = correctAnswersTotal;
        wrongAnswersCount.textContent = wrongAnswersTotal;
        skippedQuestionsCount.textContent = skippedQuestionsTotal;

        const percentage = totalQuestions > 0 ? ((correctAnswersTotal / totalQuestions) * 100).toFixed(2) : 0;
        percentageScore.textContent = `${percentage}%`;
    }

    viewResultsButton.addEventListener('click', () => {
        renderQuizResultsDetails(quizDetailsForDisplay);
        finalScoreContainer.style.display = 'none';
        quizResultsDetails.style.display = 'block';
    });

    function backToFinalScore() {
        quizResultsDetails.style.display = 'none';
        finalScoreContainer.style.display = 'block';
    }

    returnToDashboardButton.addEventListener('click', goToDashboard);

    function saveQuizResult() {
        const loggedInUser = localStorage.getItem('loggedInUser');
        let quizResults = JSON.parse(localStorage.getItem('quizResults')) || [];

        const totalQuestions = currentQuiz.questions.length;
        const newResult = {
            user: loggedInUser,
            quizName: currentQuiz.name,
            score: `${correctAnswersTotal}/${totalQuestions}`,
            numericScore: correctAnswersTotal, // Store numeric score for calculations
            totalQuestions: totalQuestions, // Store total questions for percentage calculation
            wrongAnswers: wrongAnswersTotal,
            skippedQuestionsCount: skippedQuestionsTotal,
            timestamp: new Date().toLocaleString(),
            quizDetails: quizDetailsForDisplay // Store detailed answers
        };
        quizResults.push(newResult);
        localStorage.setItem('quizResults', JSON.stringify(quizResults));
    }

    function updateQuizInfoBox() {
        const loggedInUser = localStorage.getItem('loggedInUser');
        let quizResults = JSON.parse(localStorage.getItem('quizResults')) || [];
        const userQuizResults = quizResults.filter(result => result.user === loggedInUser);

        if (userQuizResults.length > 0) {
            const lastQuiz = userQuizResults[userQuizResults.length - 1];
            quizInfoHeading.textContent = "Your Last Quiz Score:";
            
            let percentage = 'N/A';
            if (lastQuiz.numericScore !== undefined && lastQuiz.totalQuestions !== undefined && lastQuiz.totalQuestions > 0) {
                percentage = ((lastQuiz.numericScore / lastQuiz.totalQuestions) * 100).toFixed(2) + '%';
            }

            lastQuizScoreDisplay.innerHTML = `<strong>${lastQuiz.quizName}:</strong> ${lastQuiz.score} (${percentage})`;
            lastQuizScoreDisplay.style.display = 'block';
        } else {
            quizInfoHeading.textContent = "Welcome to the Quiz!";
            lastQuizScoreDisplay.style.display = 'none';
        }
    }

    function goToDashboard() {
        stopTimer(); // Ensure timer is stopped when navigating away from quiz
        quizContainer.style.display = 'none';
        finalScoreContainer.style.display = 'none';
        quizResultsDetails.style.display = 'none';
        previousQuizzesContainer.style.display = 'none';

        quizInfoBox.style.display = 'block';
        welcomeMessageDiv.style.display = 'block';

        const quizJustCompleted = localStorage.getItem('quizJustCompleted');
        if (quizJustCompleted === 'true') {
            quizCompletedMessage.classList.add('show');
            localStorage.removeItem('quizJustCompleted');
            setTimeout(() => {
                quizCompletedMessage.classList.remove('show');
            }, 3000);
        }

        updateQuizInfoBox();
    }

    function showStartQuizSection() {
        stopTimer(); // Ensure timer is stopped when navigating to start quiz section
        quizContainer.style.display = 'none';
        finalScoreContainer.style.display = 'none';
        quizResultsDetails.style.display = 'none';
        previousQuizzesContainer.style.display = 'none';
        quizInfoBox.style.display = 'block'; // Show quiz info box to allow starting
    }

    function showPreviousQuizzesSection() {
        stopTimer(); // Ensure timer is stopped when navigating to previous quizzes
        quizContainer.style.display = 'none';
        finalScoreContainer.style.display = 'none';
        quizResultsDetails.style.display = 'none';
        quizInfoBox.style.display = 'none';
        previousQuizzesContainer.style.display = 'block';

        loadPreviousQuizzesTable();
    }

    function loadPreviousQuizzesTable() {
        const loggedInUser = localStorage.getItem('loggedInUser');
        let quizResults = JSON.parse(localStorage.getItem('quizResults')) || [];
        const userQuizResults = quizResults.filter(result => result.user === loggedInUser);

        const previousQuizzesTableBody = document.getElementById('previousQuizzesTableBody');
        const noPreviousQuizzesMessage = document.getElementById('noPreviousQuizzesMessage');
        previousQuizzesTableBody.innerHTML = ''; // Clear existing rows

        if (userQuizResults.length === 0) {
            noPreviousQuizzesMessage.style.display = 'block';
            return;
        } else {
            noPreviousQuizzesMessage.style.display = 'none';
        }

        userQuizResults.forEach((result, index) => {
            const row = previousQuizzesTableBody.insertRow();
            row.insertCell(0).textContent = result.quizName || 'N/A';
            row.insertCell(1).textContent = result.score;

            let percentage = 'N/A';
            if (result.numericScore !== undefined && result.totalQuestions !== undefined && result.totalQuestions > 0) {
                percentage = ((result.numericScore / result.totalQuestions) * 100).toFixed(2) + '%';
            }
            row.insertCell(2).textContent = percentage;
            row.insertCell(3).textContent = result.timestamp;

            const actionsCell = row.insertCell(4);
            const viewDetailsButton = document.createElement('button');
            viewDetailsButton.textContent = 'View Details';
            viewDetailsButton.className = 'previous-quiz-view-btn'; // Apply new styling
            viewDetailsButton.onclick = function() {
                renderQuizResultsDetails(result.quizDetails);
                previousQuizzesContainer.style.display = 'none';
                quizResultsDetails.style.display = 'block';
            };
            actionsCell.appendChild(viewDetailsButton);
        });
    }

    // Function to render detailed quiz results (used by both final score and previous quizzes)
    function renderQuizResultsDetails(dataToRender) {
        const quizResultsDetailsContainer = document.getElementById('quizResultsDetails');
        // Clear previous content, but keep the H3 and Back button
        const existingH3 = quizResultsDetailsContainer.querySelector('h3');
        const existingBackButton = quizResultsDetailsContainer.querySelector('.back-to-score-btn');
        quizResultsDetailsContainer.innerHTML = ''; // Clear all content
        quizResultsDetailsContainer.appendChild(existingH3); // Re-add H3

        if (!dataToRender || dataToRender.length === 0) {
            const noDetailsP = document.createElement('p');
            noDetailsP.textContent = 'No detailed results available for this submission.';
            quizResultsDetailsContainer.appendChild(noDetailsP);
        } else {
            dataToRender.forEach((q, index) => {
                const resultItem = document.createElement('div');
                resultItem.classList.add('result-item');

                const questionP = document.createElement('p');
                questionP.classList.add('question');
                questionP.textContent = `${index + 1}. ${q.question}`;
                resultItem.appendChild(questionP);

                if (q.imageUrl) {
                    const questionImage = document.createElement('img');
                    questionImage.src = q.imageUrl;
                    questionImage.alt = "Question Image";
                    questionImage.classList.add('question-image');
                    resultItem.appendChild(questionImage);
                }

                const yourAnswerP = document.createElement('p');
                yourAnswerP.textContent = `Your Answer: ${q.userAnswer}`;
                if (q.isCorrect === true) {
                    yourAnswerP.classList.add('your-answer', 'correct');
                } else if (q.userAnswer === "Skipped" || q.userAnswer === "Time Out") { // Include Time Out here
                    yourAnswerP.classList.add('your-answer', 'skipped');
                } else {
                    yourAnswerP.classList.add('your-answer');
                }
                resultItem.appendChild(yourAnswerP);

                if (q.isCorrect === false || q.userAnswer === "Skipped" || q.userAnswer === "Time Out") { // Include Time Out here
                    const correctAnswerP = document.createElement('p');
                    correctAnswerP.classList.add('correct-answer');
                    correctAnswerP.textContent = `Correct Answer: ${q.answer}`;
                    resultItem.appendChild(correctAnswerP);
                }

                quizResultsDetailsContainer.appendChild(resultItem);
            });
        }
        quizResultsDetailsContainer.appendChild(existingBackButton); // Re-add Back button at the end
    }

    // Initial setup: Hide specific quiz sections on load
    quizContainer.style.display = 'none';
    finalScoreContainer.style.display = 'none';
    quizResultsDetails.style.display = 'none';
    previousQuizzesContainer.style.display = 'none';
    quizInfoBox.style.display = 'block';
    updateProgressBar();
    updateQuizInfoBox(); // Call on initial load

  </script>
</body>
</html>